models:
  Company:
    name: string
    country_code: char:2
    vat_id: string nullable
    base_currency: char:3 default:EUR
    default_vat_rate: decimal:5,2 default:0
    invoice_prefix: string default:INV-
    relationships:
      hasMany: Client, Invoice, Subscription

  Plan:
    code: string unique
    name: string
    monthly_price_eur: integer
    invoice_monthly_limit: integer nullable
    relationships:
      hasMany: Subscription

  Subscription:
    company_id: id foreign:companies
    plan_id: id foreign:plans
    starts_at: timestamp
    ends_at: timestamp nullable
    relationships:
      belongsTo: Company, Plan

  Client:
    company_id: id foreign:companies
    name: string
    country_code: char:2
    vat_id: string nullable
    softDeletes: true
    relationships:
      belongsTo: Company
      hasMany: Invoice

  TaxRate:
    country_code: char:2 unique
    tax_type: string default:vat
    standard_rate: decimal:5,2 default:0
    source: string nullable

  Invoice:
    company_id: id foreign:companies
    client_id: id foreign:clients
    public_id: uuid unique
    share_token: string:64 nullable index
    number: string nullable
    status: string default:draft
    issue_date: date nullable
    due_date: date nullable

    tax_treatment: string default:DOMESTIC
    vat_rate: decimal:5,2 default:0
    vat_reason_text: string nullable

    subtotal_minor: bigInteger default:0
    vat_minor: bigInteger default:0
    total_minor: bigInteger default:0

    relationships:
      belongsTo: Company, Client
      hasMany: InvoiceItem

  InvoiceItem:
    invoice_id: id foreign:invoices
    description: text
    quantity: decimal:10,2 default:1
    unit_price_minor: bigInteger default:0
    line_total_minor: bigInteger default:0
    relationships:
      belongsTo: Invoice

controllers:
  ClientController:
    resource: web
  InvoiceController:
    resource: web
